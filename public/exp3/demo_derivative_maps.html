<!DOCTYPE html>
<html lang="en">
<head>
    <title>exp3 - demo_derivative_maps</title>
    <meta charset="utf-8">
</head>
<body>

    <script src="../threejs/build/three.min.js"></script>
    <script src="./js/exp3.js"></script>
    <script src="./js/dat.gui.min.js"></script>
    <script>

function Config()
{
    this.bumpness = 8.0;
    
    var gui = new dat.GUI();
    gui.add( this, 'bumpness', 1.0, 16.0 ).step( 0.25 );
}

var mesh;
var material;
var config;

function on_init( )
{
    config = new Config();
    
    this.renderer.context.getExtension( "OES_standard_derivatives" );
    this.defaults.camera.position.z = 400;

    var geometry = new THREE.CubeGeometry( 200, 200, 200 );
    
    var texture = THREE.ImageUtils.loadTexture( "assets/wall002_height.png" );
    texture.anisotropy = this.renderer.getMaxAnisotropy();
    texture.minFilter = texture.magFilter = THREE.LinearFilter;
    
    material = new THREE.ShaderMaterial( {
        uniforms : { 
            heightMap: { type: "t", value: texture },
            bumpness : { type: "f", value: config.bumpness },
        },
        vertexShader   : this.loadText( "./assets/derivativemaps.vs" ),
        fragmentShader : this.loadText( "./assets/derivativemaps.fs" ),
        } );

    mesh = new THREE.Mesh( geometry, material );
    this.defaults.scene.add( mesh );
}

function on_resize( width, height )
{
    this.defaults.camera.aspect = width / height;
    this.defaults.camera.updateProjectionMatrix();
}

function on_render( )
{
    material.uniforms.bumpness.value = config.bumpness;
    
    mesh.rotation.x += 0.0025;
    mesh.rotation.y += 0.005;

    this.renderer.render( this.defaults.scene, this.defaults.camera );
}

new Exp3( {
    bgcolor : "#202020",
    on_init : on_init, 
    on_resize : on_resize, 
    on_render : on_render 
    } );

    </script>

</body>
</html>
