<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>derivative-pom</title>
		<link rel="stylesheet" href="css/common.css">
	</head>
	<body>
		<div id="rootDiv"><canvas id="renderCanvas"></canvas></div>
		<script src="js/babylon.1.12.js"></script>
		<script src="js/hand-1.3.8.js"></script>
		<script type="text/javascript">

function run()
{
	var canvas = document.getElementById ("renderCanvas");		
	var engine = new BABYLON.Engine (canvas, true);

	var scene = new BABYLON.Scene (engine);
	
	BABYLON.Engine.ShadersRepository = "./fx/";
	var mtl = new BABYLON.ShaderMaterial ("shaderMaterial", scene, "derivativepom",
	{	
		attributes: ["position", "uv", "normal"],
		uniforms: ["worldViewProjection", "world"]
	});
	
	mtl.onCompiled = function () {
	};
	
	mtl.onError = function (sender, errors) {
		console.log (errors);
	};

	// Creating a camera looking to the zero point (0,0,0), a light, and a sphere of size 1
	var camera = new BABYLON.ArcRotateCamera ("Camera", 1, 0.8, 20, new BABYLON.Vector3 (0, 0, 0), scene);
	var sphere = BABYLON.Mesh.CreateBox ("Sphere", 5.0, scene);
	sphere.material = mtl;
	
	var tex = new BABYLON.Texture ("img/brick_grad.png", scene);
	//tex.wrapU = BABYLON.Texture.CLAMP_ADDRESSMODE;
	//tex.wrapV = BABYLON.Texture.CLAMP_ADDRESSMODE;
	
	// Attach the camera to the scene
	scene.activeCamera.attachControl (canvas);

	// Once the scene is loaded, just register a render loop to render it
	engine.runRenderLoop (function () {
	
		mtl.setTexture ("heightMap", tex);
		mtl.setFloat ("tile", 2.0);
		mtl.setFloat ("bumpness", 1.0);
		mtl.setFloat ("useParallax", 1.0);
		mtl.setFloat ("parallaxHeight", 0.5);
		mtl.setFloat ("parallaxSampleCount", 8.0);
		mtl.setFloat ("useSpecular", 1.0);
		mtl.setFloat ("occlusion", 0.5);
		mtl.setFloat ("debug", 0.0);
		
		mtl.setVector3 ("camPos", camera.position);
		
		/*
		uniform float parallaxSampleCount;
		uniform float occlusion;
		uniform float useParallax;
		uniform float useSilhouette;
		uniform float useSpecular;
		uniform float debug;
		*/
		mtl.backFaceCulling = false;
		
		scene.render();
	});
}

if (!BABYLON.Engine.isSupported())
{
	window.alert('Browser not supported');
}
else
{
	run();
}
		</script>
	</body>
</html>
